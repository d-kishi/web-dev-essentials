# ECサイト商品管理システム 要件定義書

## 目次

1. [プロジェクト概要](#1-プロジェクト概要)
   - [1.1 目的](#11-目的)
   - [1.2 対象者](#12-対象者)
   - [1.3 教育目標](#13-教育目標)
2. [技術要件](#2-技術要件)
   - [2.1 フレームワーク・ライブラリ](#21-フレームワークライブラリ)
   - [2.2 アーキテクチャ](#22-アーキテクチャ)
   - [2.3 ネームスペース構成](#23-ネームスペース構成)
3. [機能要件](#3-機能要件)
   - [3.1 商品管理機能](#31-商品管理機能)
   - [3.2 商品カテゴリ管理機能](#32-商品カテゴリ管理機能)
4. [非機能要件](#4-非機能要件)
   - [4.1 認証・認可](#41-認証認可)
   - [4.2 データベース](#42-データベース)
   - [4.3 ファイル管理](#43-ファイル管理)
5. [技術的制約・方針](#5-技術的制約方針)
   - [5.1 JavaScript関連](#51-javascript関連)
   - [5.2 コーディング方針](#52-コーディング方針)
   - [5.3 学習重点項目](#53-学習重点項目)
6. [画面構成](#6-画面構成)
   - [6.1 商品管理画面群](#61-商品管理画面群)
   - [6.2 カテゴリ管理画面群](#62-カテゴリ管理画面群)
   - [6.3 View設計基本方針](#63-view設計基本方針)
7. [データモデル](#7-データモデル)
   - [7.1 商品エンティティ](#71-商品エンティティ)
   - [7.2 カテゴリエンティティ](#72-カテゴリエンティティ)
8. [クリーンアーキテクチャ構成](#8-クリーンアーキテクチャ構成)
   - [8.1 レイヤー構造](#81-レイヤー構造)
   - [8.2 依存関係の方向](#82-依存関係の方向)
   - [8.3 教育ポイント](#83-教育ポイント)

---

## 1. プロジェクト概要

### 1.1 目的
.NET MVCを使用したECサイトの商品管理機能の基礎教育用アプリケーションの開発

### 1.2 対象者
- 経験年数3年程度のC#エンジニア（C# 7.3, .NET Framework 4 経験）
- フロントエンド技術（HTML, JavaScript, CSS）の知識がない初級者〜中級者

### 1.3 教育目標
- C# 8.0～11の新機能の習得（.NET 8対応）
- フロントエンド技術（HTML, JavaScript, CSS）の基礎習得
- MVC アーキテクチャの理解（特にController、Validation）
- **クリーンアーキテクチャの基礎理解**
- Pure JavaScriptでのAjax通信の理解（Fetch API使用）

## 2. 技術要件

### 2.1 フレームワーク・ライブラリ
- **.NET 8**
- **Entity Framework Core**（InMemoryデータベースプロバイダー使用）
- **RxJS**（API通信用）
- **Fetch API**（HTTP通信用）
- **Pure JavaScript**（jQueryは使用禁止）

### 2.2 アーキテクチャ
- **MVC パターン**
- **クリーンアーキテクチャ**（教育用サンプル）
- **ネイティブ構成**（RIAインターフェース、JavaScriptライブラリなし）

### 2.3 ネームスペース構成
- **ルートネームスペース**: `Web.Essentials`

### 2.4 プロジェクト構成

#### 2.4.1 ソリューション構成
- **ソリューション名**: `Web.Essentials.sln`

#### 2.4.2 プロジェクト分割（クリーンアーキテクチャ対応）
以下の3プロジェクト構成でレイヤー分離を実現：

1. **Web.Essentials.Domain** (Class Library)
   - ドメイン層の実装
   - エンティティ、値オブジェクト、ドメインサービス
   - リポジトリインターフェース
   - 他プロジェクトに依存しない純粋なドメインロジック

2. **Web.Essentials.Infrastructure** (Class Library)  
   - インフラストラクチャ層の実装
   - リポジトリ実装、Entity Framework DbContext
   - 外部サービス連携
   - Web.Essentials.Domain に依存

3. **Web.Essentials.App** (ASP.NET Core MVC)
   - プレゼンテーション層とアプリケーション層
   - Controllers、ViewModels、Views
   - アプリケーションサービス、DTOs
   - Web.Essentials.Domain、Web.Essentials.Infrastructure に依存

#### 2.4.3 プロジェクト参照関係
```
Web.Essentials.App
├── → Web.Essentials.Domain
└── → Web.Essentials.Infrastructure
    └── → Web.Essentials.Domain
```

#### 2.4.4 開発環境
- **VSCode**（メイン開発環境）
- **Visual Studio 2022**（互換性確保）

## 3. 機能要件

### 3.1 商品管理機能

#### 3.1.1 商品登録機能
- 商品情報の新規登録
- 商品画像のアップロード機能
- バリデーション機能

#### 3.1.2 商品編集機能
- 既存商品情報の編集
- 商品画像の変更・削除

#### 3.1.3 商品一覧機能
- 商品一覧の表示
- **検索機能**（Ajax通信使用）
- **ページング機能**（Ajax通信使用）
- 画面反映はAjax結果を使用

### 3.2 商品カテゴリ管理機能

#### 3.2.1 カテゴリ登録機能
- カテゴリ情報の新規登録
- バリデーション機能

#### 3.2.2 カテゴリ編集機能
- 既存カテゴリ情報の編集

#### 3.2.3 カテゴリ一覧機能
- カテゴリ一覧の表示
- **検索機能**（Ajax通信使用）
- **ページング機能**（Ajax通信使用）

## 4. 非機能要件

### 4.1 認証・認可
- **認証機能は不要**

### 4.2 データベース
- **Entity Framework Core InMemoryデータベースプロバイダー**使用
- 教育目的のため、永続化は不要

### 4.3 ファイル管理
- 商品画像のアップロード・保存機能

## 5. 技術的制約・方針

### 5.1 JavaScript関連
- **Pure JavaScript使用**（jQueryは使用禁止）
- **RxJS使用**（API通信のみ）
- **Fetch API使用**（HTTP通信）
- 一覧画面のバックエンドリクエストは**Ajax**で実装
- 基本的にはネイティブJavaScriptで完結

### 5.2 コーディング方針
- **C# 8.0～11の新機能を積極的に使用**（.NET 8対応）
- **ソースコードコメントを詳細に記載**（神経質なレベル）
- 初級者〜中級者向けの理解しやすいコード
- WSL2環境での開発に対応

### 5.3 学習重点項目
1. **フロントエンド技術**（HTML, JavaScript, CSS）- 最重要
2. **Controller** - 重要
3. **Validation** - 重要
4. **クリーンアーキテクチャ** - 重要
5. **Model** - 基本レベル

## 6. 画面構成

### 6.1 商品管理画面群
- 商品一覧画面（検索・ページング機能付き）
- 商品登録画面
- 商品編集画面

### 6.2 カテゴリ管理画面群
- カテゴリ一覧画面（検索・ページング機能付き）
- カテゴリ登録画面
- カテゴリ編集画面

### 6.3 View設計基本方針

#### 6.3.1 コンポーネント化による再利用性
- **DRY原則の徹底**：Create、Edit、Delete画面の共通部分を可能な限りコンポーネント化
- **Partial View活用**：共通UIコンポーネントを部分ビューとして分離
- **再利用可能なフォーム要素**：入力フィールド、ボタン、バリデーション表示等の共通化

#### 6.3.2 具体的なコンポーネント分割例

##### 6.3.2.1 商品管理画面共通コンポーネント
- **商品フォーム部分ビュー** (`_ProductForm.cshtml`)
  - 商品名、説明、価格、JANコード入力フィールド
  - Create/Edit画面で共通利用
- **商品画像管理部分ビュー** (`_ProductImageUpload.cshtml`)
  - 画像アップロード、プレビュー、削除機能
  - Create/Edit画面で共通利用
- **カテゴリ選択部分ビュー** (`_CategorySelect.cshtml`)
  - 階層構造対応のカテゴリ選択UI
  - 商品Create/Edit画面で共通利用
- **商品詳細表示部分ビュー** (`_ProductDetails.cshtml`)
  - 商品情報の読み取り専用表示
  - Details/Delete確認画面で共通利用

##### 6.3.2.2 カテゴリ管理画面共通コンポーネント
- **カテゴリフォーム部分ビュー** (`_CategoryForm.cshtml`)
  - カテゴリ名、説明、親カテゴリ選択フィールド
  - Create/Edit画面で共通利用
- **カテゴリ階層表示部分ビュー** (`_CategoryHierarchy.cshtml`)
  - ツリー構造での階層表示
  - Index/Details画面で共通利用

##### 6.3.2.3 共通UI部分ビュー
- **検索フォーム部分ビュー** (`_SearchForm.cshtml`)
  - Ajax検索用の共通検索フォーム
  - 商品・カテゴリ一覧画面で共通利用
- **ページング部分ビュー** (`_Pagination.cshtml`)
  - ページング用のナビゲーションUI
  - 一覧画面で共通利用
- **メッセージ表示部分ビュー** (`_Messages.cshtml`)
  - 成功・エラーメッセージの表示
  - 全画面で共通利用
- **確認モーダル部分ビュー** (`_ConfirmationModal.cshtml`)
  - 削除確認等の汎用モーダル
  - Delete処理で共通利用

#### 6.3.3 コンポーネント設計方針
- **ViewModelの共通化**：コンポーネント用の専用ViewModelを作成
- **JavaScript関数の共通化**：Ajax通信、バリデーション、UI操作の共通ライブラリ化
- **CSS クラスの共通化**：UI コンポーネント用の再利用可能なCSSクラス定義
- **エラーハンドリングの統一**：バリデーションエラー表示の共通化

#### 6.3.4 教育効果
- **保守性向上**：重複コードの削減による保守性の実感
- **再利用性の理解**：コンポーネント分割による開発効率向上の体験
- **MVCパターンの深化**：部分ビューとViewModelの関係性の理解
- **フロントエンド設計思想**：モジュール化、コンポーネント指向の学習

## 7. データモデル

### 7.1 商品エンティティ
- 商品ID
- 商品名
- 商品説明
- 価格
- カテゴリID（外部キー）
- 商品画像パス
- 作成日時
- 更新日時

### 7.2 カテゴリエンティティ
- カテゴリID
- カテゴリ名
- カテゴリ説明
- 作成日時
- 更新日時

## 8. クリーンアーキテクチャ構成

### 8.1 レイヤー構造
アプリケーションは以下のレイヤーに分割して実装：

#### 8.1.1 Presentation Layer (プレゼンテーション層)
- **Controllers** - MVCコントローラー (`Web.Essentials.App.Controllers`)
- **ViewModels** - 画面表示用モデル (`Web.Essentials.App.ViewModels`)
  - **特性**: MVC画面専用、バリデーション属性あり、ファイルアップロード対応、画面制御用プロパティ含む
  - **用途**: Razorビューでの画面表示、フォーム操作、サーバーサイドバリデーション
- **Views** - Razorビュー

#### 8.1.2 Application Layer (アプリケーション層)
- **Services** - アプリケーションサービス (`Web.Essentials.App.Services`)
- **DTOs** - データ転送オブジェクト (`Web.Essentials.App.DTOs`)
  - **特性**: API応答専用、軽量、バリデーション属性なし
  - **用途**: Ajax通信のJSON応答、API間データ転送
- **Interfaces** - サービスインターフェース (`Web.Essentials.App.Interfaces`)

#### 8.1.3 Domain Layer (ドメイン層)
- **Entities** - ドメインエンティティ (`Web.Essentials.Domain.Entities`)
- **Value Objects** - 値オブジェクト (`Web.Essentials.Domain.ValueObjects`)
- **Domain Services** - ドメインサービス (`Web.Essentials.Domain.Services`)
- **Repository Interfaces** - リポジトリインターフェース (`Web.Essentials.Domain.Repositories`)

#### 8.1.4 Infrastructure Layer (インフラストラクチャ層)
- **Repositories** - リポジトリ実装 (`Web.Essentials.Infrastructure.Repositories`)
- **DbContext** - Entity Framework DbContext (`Web.Essentials.Infrastructure.Data`)
- **External Services** - 外部サービス連携 (`Web.Essentials.Infrastructure.Services`)

### 8.2 依存関係の方向
- Presentation → Application → Domain
- Infrastructure → Domain
- **依存関係逆転の原則**を適用（インターフェースによる抽象化）

### 8.3 教育ポイント
- **関心の分離** - 各レイヤーの責務の明確化
- **依存関係逆転** - インターフェースを使った疎結合
- **単一責任原則** - クラス・メソッドの責務の単一化