@model Web.Essentials.App.ViewModels.ProductCreateViewModel

<!-- å•†å“ãƒ•ã‚©ãƒ¼ãƒ éƒ¨åˆ†ãƒ“ãƒ¥ãƒ¼ -->
<!-- Create/Editç”»é¢ã§å…±é€šåˆ©ç”¨ã™ã‚‹å•†å“å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  -->
<div class="product-form-container">
    <!-- åŸºæœ¬æƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="form-section">
        <h3 class="section-title">åŸºæœ¬æƒ…å ±</h3>
        <div class="form-grid">
            <!-- å•†å“å -->
            <div class="form-group">
                <label asp-for="Name" class="form-label required">å•†å“å</label>
                <input asp-for="Name" 
                       class="form-input" 
                       placeholder="å•†å“åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"
                       maxlength="100"
                       autocomplete="off" />
                <span asp-validation-for="Name" class="validation-error"></span>
                <div class="field-help">
                    <small>æœ€å¤§100æ–‡å­—ã¾ã§å…¥åŠ›å¯èƒ½ã§ã™</small>
                </div>
            </div>
            
            <!-- ä¾¡æ ¼ -->
            <div class="form-group">
                <label asp-for="Price" class="form-label required">ä¾¡æ ¼</label>
                <div class="price-input-group">
                    <span class="price-currency">Â¥</span>
                    <input asp-for="Price" 
                           class="form-input price-input" 
                           type="number"
                           min="0"
                           max="9999999"
                           step="1"
                           placeholder="0"
                           oninput="formatPrice(this)" />
                </div>
                <span asp-validation-for="Price" class="validation-error"></span>
                <div class="field-help">
                    <small>ç¨è¾¼ä¾¡æ ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆå††ï¼‰</small>
                </div>
            </div>
            
            <!-- ã‚«ãƒ†ã‚´ãƒª -->
            <div class="form-group">
                <label asp-for="CategoryId" class="form-label required">ã‚«ãƒ†ã‚´ãƒª</label>
                <select asp-for="CategoryId" class="form-select">
                    <option value="">ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠã—ã¦ãã ã•ã„</option>
                    @if (Model?.Categories != null)
                    {
                        @foreach (var category in Model.Categories)
                        {
                            <option value="@category.Id">@category.Name</option>
                        }
                    }
                </select>
                <span asp-validation-for="CategoryId" class="validation-error"></span>
                <div class="field-help">
                    <small>å•†å“ãŒå±ã™ã‚‹ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠã—ã¦ãã ã•ã„</small>
                </div>
            </div>
            
            <!-- JANã‚³ãƒ¼ãƒ‰ -->
            <div class="form-group">
                <label asp-for="JanCode" class="form-label">JANã‚³ãƒ¼ãƒ‰</label>
                <input asp-for="JanCode" 
                       class="form-input" 
                       placeholder="JANã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä»»æ„ï¼‰"
                       maxlength="13"
                       pattern="[0-9]{8,13}"
                       autocomplete="off"
                       oninput="validateJanCode(this)" />
                <span asp-validation-for="JanCode" class="validation-error"></span>
                <div id="janCodeValidation" class="field-validation" style="display: none;"></div>
                <div class="field-help">
                    <small>8ã€œ13æ¡ã®æ•°å­—ã§å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä»»æ„ï¼‰</small>
                </div>
            </div>
        </div>
    </div>
    
    <!-- å•†å“èª¬æ˜ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="form-section">
        <h3 class="section-title">å•†å“èª¬æ˜</h3>
        <div class="form-group">
            <label asp-for="Description" class="form-label">å•†å“èª¬æ˜</label>
            <textarea asp-for="Description" 
                      class="form-textarea" 
                      rows="5"
                      placeholder="å•†å“ã®è©³ç´°èª¬æ˜ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä»»æ„ï¼‰"
                      maxlength="1000"
                      oninput="updateCharacterCount(this, 'descriptionCount')"></textarea>
            <span asp-validation-for="Description" class="validation-error"></span>
            <div class="character-count">
                <span id="descriptionCount">0</span> / 1000æ–‡å­—
            </div>
            <div class="field-help">
                <small>å•†å“ã®ç‰¹å¾´ã€ä½¿ç”¨æ–¹æ³•ã€æ³¨æ„äº‹é …ãªã©ã‚’è¨˜è¼‰ã—ã¦ãã ã•ã„</small>
            </div>
        </div>
    </div>
    
    <!-- å•†å“ç”»åƒã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="form-section">
        <h3 class="section-title">å•†å“ç”»åƒ</h3>
        <div class="form-group">
            <label for="imageFiles" class="form-label">ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«</label>
            <div class="image-upload-area">
                <input type="file" 
                       id="imageFiles" 
                       name="ImageFiles" 
                       class="image-input" 
                       accept="image/*" 
                       multiple
                       onchange="handleImageUpload(this)" />
                <label for="imageFiles" class="image-upload-label">
                    <div class="upload-icon">ğŸ“</div>
                    <div class="upload-text">
                        <strong>ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</strong><br>
                        <small>ã¾ãŸã¯ã€ã“ã“ã«ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—</small>
                    </div>
                </label>
            </div>
            <div class="field-help">
                <small>JPEGã€PNGã€GIFå½¢å¼ã®ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¤‡æ•°é¸æŠå¯èƒ½ã§ã™ï¼ˆæœ€å¤§5MB/ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰</small>
            </div>
            
            <!-- ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¨ãƒªã‚¢ -->
            <div id="imagePreviewArea" class="image-preview-area" style="display: none;">
                <h4 class="preview-title">é¸æŠã•ã‚ŒãŸç”»åƒ</h4>
                <div id="imagePreviewList" class="image-preview-list">
                    <!-- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»åƒãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
    <div id="formValidationSummary" class="form-validation-summary" style="display: none;">
        <h4 class="validation-title">å…¥åŠ›ã‚¨ãƒ©ãƒ¼</h4>
        <ul id="validationErrorList" class="validation-error-list">
            <!-- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
        </ul>
    </div>
</div>

<!-- æ—¢å­˜ç”»åƒè¡¨ç¤ºç”¨ï¼ˆç·¨é›†æ™‚ã®ã¿ï¼‰ -->
@{
    var hasExistingImages = false;
    object existingImages = null;
    try 
    {
        var existingImagesProperty = Model.GetType().GetProperty("ExistingImages");
        existingImages = existingImagesProperty?.GetValue(Model);
        hasExistingImages = existingImages != null && ((IEnumerable<object>)existingImages).Any();
    }
    catch
    {
        hasExistingImages = false;
    }
}
@if (hasExistingImages)
{
    <div class="form-section">
        <h3 class="section-title">ç¾åœ¨ã®å•†å“ç”»åƒ</h3>
        <div class="existing-images-area">
            @foreach (var image in ((IEnumerable<Web.Essentials.App.ViewModels.ProductImageViewModel>)existingImages).OrderBy(img => img.DisplayOrder))
            {
                <div class="existing-image-item" data-image-id="@image.Id">
                    <div class="image-container">
                        <img src="@image.ImagePath" alt="å•†å“ç”»åƒ" class="existing-image" />
                        <div class="image-overlay">
                            <button type="button" 
                                    class="btn btn-danger btn-sm delete-image-btn" 
                                    onclick="deleteExistingImage(@image.Id)"
                                    title="ã“ã®ç”»åƒã‚’å‰Šé™¤">
                                å‰Šé™¤
                            </button>
                        </div>
                    </div>
                    <div class="image-info">
                        <small>è¡¨ç¤ºé †: @image.DisplayOrder</small>
                    </div>
                </div>
            }
        </div>
    </div>
}