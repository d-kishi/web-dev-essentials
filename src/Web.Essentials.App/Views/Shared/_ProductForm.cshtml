@model Web.Essentials.App.ViewModels.Interfaces.IProductFormViewModel

<!-- å•†å“ãƒ•ã‚©ãƒ¼ãƒ éƒ¨åˆ†ãƒ“ãƒ¥ãƒ¼ -->
<!-- Create/Editç”»é¢ã§å…±é€šåˆ©ç”¨ã™ã‚‹å•†å“å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  -->
<div class="product-form-container">
    <!-- åŸºæœ¬æƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="form-section">
        <h3 class="section-title">åŸºæœ¬æƒ…å ±</h3>
        <div class="form-column">
            <!-- å•†å“å -->
            <div class="form-group">
                <label asp-for="Name" class="form-label required">å•†å“å</label>
                <input asp-for="Name" 
                       class="form-input" 
                       placeholder="å•†å“åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"
                       maxlength="100"
                       autocomplete="off" />
                <span asp-validation-for="Name" class="validation-error"></span>
                <div class="field-help">
                    <small>æœ€å¤§100æ–‡å­—ã¾ã§å…¥åŠ›å¯èƒ½ã§ã™</small>
                </div>
            </div>
            
            <!-- ä¾¡æ ¼ -->
            <div class="form-group">
                <label asp-for="Price" class="form-label required">ä¾¡æ ¼</label>
                <div class="price-input-group">
                    <span class="price-currency">Â¥</span>
                    <input asp-for="Price" 
                           class="form-input price-input" 
                           type="number"
                           min="0"
                           max="9999999"
                           step="1"
                           placeholder="0"
                           />
                </div>
                <span asp-validation-for="Price" class="validation-error"></span>
                <div class="field-help">
                    <small>ç¨è¾¼ä¾¡æ ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆå††ï¼‰</small>
                </div>
            </div>
            
            <!-- ã‚«ãƒ†ã‚´ãƒªï¼ˆæœ€ä¸‹ä½ã®ã¿è¡¨ç¤ºã€éšå±¤ãƒ©ãƒ™ãƒ«ï¼‰ -->
            <div class="form-group">
                <label asp-for="SelectedCategoryIds" class="form-label required">ã‚«ãƒ†ã‚´ãƒª</label>
                <div class="category-checkbox-list">
                    @if (Model?.Categories != null)
                    {
                        @foreach (var category in Model.Categories)
                        {
                            var isSelected = Model.SelectedCategoryIds?.Contains(category.Id) == true;
                            <div class="category-checkbox-item">
                                <input type="checkbox" 
                                       id="category_@category.Id" 
                                       name="SelectedCategoryIds" 
                                       value="@category.Id" 
                                       @(isSelected ? "checked" : "")
                                       class="category-checkbox" />
                                <label for="category_@category.Id" class="category-checkbox-label">
                                    <span class="category-path">@category.FullPath</span>
                                </label>
                            </div>
                        }
                    }
                </div>
                <span asp-validation-for="SelectedCategoryIds" class="validation-error"></span>
                <div class="field-help">
                    <small>æœ€ä¸‹ä½ã®ã‚«ãƒ†ã‚´ãƒªã®ã¿è¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã™ï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰</small>
                </div>
            </div>
            
            <!-- å•†å“ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ -->
            <div class="form-group">
                <label asp-for="Status" class="form-label required">å•†å“ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</label>
                <select asp-for="Status" asp-items="Model?.StatusSelectItems" class="form-select">
                </select>
                <span asp-validation-for="Status" class="validation-error"></span>
                <div class="field-help">
                    <small>å•†å“ã®è²©å£²çŠ¶æ³ã‚’é¸æŠã—ã¦ãã ã•ã„</small>
                </div>
            </div>
            
            <!-- JANã‚³ãƒ¼ãƒ‰ -->
            <div class="form-group">
                <label asp-for="JanCode" class="form-label">JANã‚³ãƒ¼ãƒ‰</label>
                <input asp-for="JanCode" 
                       class="form-input" 
                       placeholder="JANã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä»»æ„ï¼‰"
                       maxlength="13"
                       pattern="[0-9]{8,13}"
                       autocomplete="off"
                       />
                <span asp-validation-for="JanCode" class="validation-error"></span>
                <div id="janCodeValidation" class="field-validation" style="display: none;"></div>
                <div class="field-help">
                    <small>8ã€œ13æ¡ã®æ•°å­—ã§å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä»»æ„ï¼‰</small>
                </div>
            </div>
        </div>
    </div>
    
    <!-- å•†å“èª¬æ˜ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="form-section">
        <h3 class="section-title">å•†å“èª¬æ˜</h3>
        <div class="form-group">
            <label asp-for="Description" class="form-label">å•†å“èª¬æ˜</label>
            <textarea asp-for="Description" 
                      class="form-textarea" 
                      rows="5"
                      placeholder="å•†å“ã®è©³ç´°èª¬æ˜ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä»»æ„ï¼‰"
                      maxlength="1000"
                      ></textarea>
            <span asp-validation-for="Description" class="validation-error"></span>
            <div class="character-count">
                <span id="descriptionCount">0</span> / 1000æ–‡å­—
            </div>
            <div class="field-help">
                <small>å•†å“ã®ç‰¹å¾´ã€ä½¿ç”¨æ–¹æ³•ã€æ³¨æ„äº‹é …ãªã©ã‚’è¨˜è¼‰ã—ã¦ãã ã•ã„</small>
            </div>
        </div>
    </div>
    
    <!-- å•†å“ç”»åƒã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="form-section">
        <h3 class="section-title">å•†å“ç”»åƒ</h3>
        <div class="form-group">
            <label for="imageFiles" class="form-label">ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«</label>
            
            <!-- ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠã‚¨ãƒªã‚¢ -->
            <div class="image-upload-zone" id="imageUploadZone">
                <div class="upload-content">
                    <div class="upload-icon">ğŸ“·</div>
                    <h4 class="upload-title">ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</h4>
                    <p class="upload-description">
                        ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã™ã‚‹ã‹ã€ã‚¯ãƒªãƒƒã‚¯ã—ã¦é¸æŠã—ã¦ãã ã•ã„
                    </p>
                    <button type="button" class="btn btn-outline" data-action="select-file">
                        ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ
                    </button>
                    <input type="file" 
                           id="imageFiles" 
                           name="ImageFiles" 
                           accept="image/jpeg,image/png,image/gif" 
                           multiple 
                           style="display: none;"
                           />
                </div>
                <div class="upload-constraints">
                    <small>
                        â€¢ å¯¾å¿œå½¢å¼: JPEG, PNG, GIF<br>
                        â€¢ æœ€å¤§ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º: 5MB<br>
                        â€¢ æœ€å¤§5æšã¾ã§ç™»éŒ²å¯èƒ½
                    </small>
                </div>
            </div>
            
            <!-- ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¨ãƒªã‚¢ -->
            <div id="imagePreviewArea" class="image-preview-area" style="display: none;">
                <h4 class="preview-title">é¸æŠã•ã‚ŒãŸç”»åƒ</h4>
                <div id="imagePreviewContainer" class="image-preview-container">
                    <!-- ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
                </div>
                <div class="preview-actions">
                    <button type="button" class="btn btn-outline btn-sm" data-action="clear-all">
                        ã™ã¹ã¦ã‚¯ãƒªã‚¢
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
    <div id="formValidationSummary" class="form-validation-summary" style="display: none;">
        <h4 class="validation-title">å…¥åŠ›ã‚¨ãƒ©ãƒ¼</h4>
        <ul id="validationErrorList" class="validation-error-list">
            <!-- ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
        </ul>
    </div>
</div>

<!-- æ—¢å­˜ç”»åƒè¡¨ç¤ºç”¨ï¼ˆç·¨é›†æ™‚ã®ã¿ï¼‰ -->
@{
    var hasExistingImages = false;
    IEnumerable<Web.Essentials.App.ViewModels.ProductImageViewModel>? existingImages = null;
    try 
    {
        var existingImagesProperty = Model?.GetType().GetProperty("ExistingImages");
        var existingImagesValue = existingImagesProperty?.GetValue(Model);
        if (existingImagesValue is IEnumerable<Web.Essentials.App.ViewModels.ProductImageViewModel> images)
        {
            existingImages = images;
            hasExistingImages = existingImages.Any();
        }
    }
    catch
    {
        hasExistingImages = false;
    }
}
@if (hasExistingImages && existingImages != null)
{
    <div class="form-section">
        <h3 class="section-title">ç¾åœ¨ã®å•†å“ç”»åƒ</h3>
        <div class="existing-images-area">
            @foreach (var image in existingImages.OrderBy(img => img.DisplayOrder))
            {
                <div class="existing-image-item" data-image-id="@image.Id">
                    <div class="image-container">
                        <img src="@image.ImagePath" alt="å•†å“ç”»åƒ" class="existing-image" />
                        <div class="image-overlay">
                            <button type="button" 
                                    class="btn btn-danger btn-sm delete-image-btn" 
                                    data-image-id="@image.Id"
                                    title="ã“ã®ç”»åƒã‚’å‰Šé™¤">
                                å‰Šé™¤
                            </button>
                        </div>
                    </div>
                    <div class="image-info">
                        <small>è¡¨ç¤ºé †: @image.DisplayOrder</small>
                    </div>
                </div>
            }
        </div>
    </div>
}

<!-- ç”»åƒç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="imageEditModal" class="modal-overlay image-edit-modal" style="display: none;">
    <div class="modal-dialog modal-medium">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ç”»åƒç·¨é›†</h3>
                <button type="button" class="modal-close" data-action="close-modal">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="image-edit-container">
                    <div class="image-edit-preview">
                        <img id="editPreviewImage" src="" alt="ç·¨é›†å¯¾è±¡ç”»åƒ" class="edit-preview-img" />
                    </div>
                    <div class="image-edit-form">
                        <div class="form-group">
                            <label for="imageAltText" class="form-label">ä»£æ›¿ãƒ†ã‚­ã‚¹ãƒˆ</label>
                            <input type="text" 
                                   id="imageAltText" 
                                   class="form-input" 
                                   placeholder="ç”»åƒã®èª¬æ˜ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"
                                   maxlength="200" />
                            <div class="field-help">
                                <small>ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£å‘ä¸Šã®ãŸã‚ã€ç”»åƒã®å†…å®¹ã‚’èª¬æ˜ã—ã¦ãã ã•ã„ï¼ˆæœ€å¤§200æ–‡å­—ï¼‰</small>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <div class="checkbox-group">
                                <label class="checkbox-label">
                                    <input type="checkbox" id="imageIsMain" class="checkbox-input">
                                    <span class="checkbox-custom"></span>
                                    ãƒ¡ã‚¤ãƒ³ç”»åƒã¨ã—ã¦è¨­å®š
                                </label>
                            </div>
                            <div class="field-help">
                                <small>å•†å“ä¸€è¦§ã‚„è©³ç´°ç”»é¢ã§æœ€åˆã«è¡¨ç¤ºã•ã‚Œã‚‹ç”»åƒã§ã™</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-action="close-modal">
                    ã‚­ãƒ£ãƒ³ã‚»ãƒ«
                </button>
                <button type="button" class="btn btn-primary" data-action="save-settings">
                    è¨­å®šã‚’ä¿å­˜
                </button>
            </div>
        </div>
    </div>
</div>