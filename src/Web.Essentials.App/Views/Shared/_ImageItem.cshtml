@model dynamic
@{
    // å‹•çš„ãƒ¢ãƒ‡ãƒ«ã‹ã‚‰å¿…è¦ãªæƒ…å ±ã‚’å–å¾—
    var imageId = ViewBag.ImageId ?? Model?.Id;
    var imagePath = ViewBag.ImagePath ?? Model?.ImagePath;
    var altText = ViewBag.AltText ?? Model?.AltText ?? "";
    var displayOrder = ViewBag.DisplayOrder ?? Model?.DisplayOrder ?? 0;
    var isMain = ViewBag.IsMain ?? Model?.IsMain ?? false;
    var isExisting = ViewBag.IsExisting ?? true; // æ—¢å­˜ç”»åƒã‹ã©ã†ã‹
    var fileName = ViewBag.FileName ?? "";
    var fileSize = ViewBag.FileSize ?? "";
    var index = ViewBag.Index ?? 0;
}

<div class="@(isExisting ? "existing-image-item" : "image-preview-item")" data-image-id="@imageId" @(isExisting ? "" : $"data-index=\"{index}\"")>
    <div class="@(isExisting ? "image-container" : "preview-image-container")">
        <img src="@imagePath" 
             alt="@(altText ?? "å•†å“ç”»åƒ")" 
             class="@(isExisting ? "existing-image" : "preview-image")" 
             data-action="open-image-viewer"
             data-image-path="@imagePath" 
             data-image-alt="@(altText ?? "å•†å“ç”»åƒ")" />
        
        <div class="@(isExisting ? "image-overlay" : "preview-overlay")">
            <button type="button" 
                    class="overlay-btn edit-btn" 
                    data-action="@(isExisting ? "edit-image" : "edit-preview-image")"
                    @(isExisting ? $"data-image-id=\"{imageId}\"" : $"data-index=\"{index}\"")
                    data-image-path="@imagePath" 
                    data-image-alt="@altText"
                    @(isExisting ? $"data-is-main=\"{imageId}\"" : "")
                    title="ç·¨é›†">
                âœï¸
            </button>
            <button type="button" 
                    class="overlay-btn delete-btn" 
                    data-action="@(isExisting ? "delete-existing-image" : "delete-preview-image")"
                    @(isExisting ? $"data-image-id=\"{imageId}\"" : $"data-index=\"{index}\"")
                    title="å‰Šé™¤">
                ğŸ—‘ï¸
            </button>
            <button type="button" 
                    class="overlay-btn view-btn" 
                    data-action="open-image-viewer"
                    data-image-path="@imagePath" 
                    data-image-alt="@(altText ?? "å•†å“ç”»åƒ")"
                    title="æ‹¡å¤§è¡¨ç¤º">
                ğŸ”
            </button>
        </div>
        
        @if (isMain)
        {
            <div class="main-badge">ãƒ¡ã‚¤ãƒ³</div>
        }
    </div>
    
    <div class="@(isExisting ? "image-info" : "preview-info")">
        @if (isExisting)
        {
            <small>è¡¨ç¤ºé †: @displayOrder</small>
            @if (!string.IsNullOrEmpty(altText))
            {
                <small class="alt-text">ä»£æ›¿ãƒ†ã‚­ã‚¹ãƒˆ: @altText</small>
            }
        }
        else
        {
            <div class="preview-name">@fileName</div>
            <div class="preview-details">
                <span class="preview-size">@fileSize</span>
                <span class="preview-order">é †åº: @(index + 1)</span>
            </div>
            @if (!string.IsNullOrEmpty(altText))
            {
                <div class="preview-alt-text" title="@altText">èª¬æ˜: @altText</div>
            }
        }
    </div>
</div>