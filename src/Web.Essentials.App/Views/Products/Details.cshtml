@model Web.Essentials.App.ViewModels.ProductDetailsViewModel
@{
    ViewData["Title"] = $"å•†å“è©³ç´° - {Model.Name}";
}

<!-- å•†å“è©³ç´°ç”»é¢ -->
<div class="page-header">
    <div class="page-title-section">
        <h1 class="page-title">å•†å“è©³ç´°</h1>
        <p class="page-description">å•†å“ã€Œ@Model.Nameã€ã®è©³ç´°æƒ…å ±ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚</p>
    </div>
    <div class="page-actions">
        <a asp-action="Edit" asp-controller="Products" asp-route-id="@Model.Id" class="btn btn-warning">
            <span class="btn-icon">âœ</span>
            ç·¨é›†
        </a>
        <button type="button" 
                class="btn btn-danger product-delete-button" 
                data-product-id="@Model.Id"
                data-product-name="@Model.Name">
            <span class="btn-icon">ğŸ—‘</span>
            å‰Šé™¤
        </button>
        <a asp-action="Index" asp-controller="Products" class="btn btn-secondary">
            <span class="btn-icon">â†</span>
            å•†å“ä¸€è¦§ã«æˆ»ã‚‹
        </a>
    </div>
</div>

<!-- ãƒ‘ãƒ³ããšãƒŠãƒ“ -->
<nav class="breadcrumb-nav" aria-label="ãƒ‘ãƒ³ããšãƒŠãƒ“">
    <ol class="breadcrumb">
        <li class="breadcrumb-item">
            <a asp-action="Index" asp-controller="Home">ãƒ›ãƒ¼ãƒ </a>
        </li>
        <li class="breadcrumb-item">
            <a asp-action="Index" asp-controller="Products">å•†å“ä¸€è¦§</a>
        </li>
        <li class="breadcrumb-item active" aria-current="page">
            @Model.Name
        </li>
    </ol>
</nav>

<!-- Anti-Forgery Token for AJAX operations -->
@Html.AntiForgeryToken()

<!-- å•†å“è©³ç´°ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
<div class="product-details-container">
    <div class="product-overview">
        <!-- å•†å“ç”»åƒã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="product-images">
            @if (Model.Images?.Any() == true)
            {
                <div class="image-gallery-flex">
                    @foreach (var image in Model.Images.OrderBy(img => img.DisplayOrder))
                    {
                        <div class="image-item @(image.IsMain ? "main-image" : "")" 
                             data-image-path="@image.ImagePath" 
                             data-image-alt="@image.AltText">
                            <img src="@image.ImagePath" 
                                 alt="@image.AltText" 
                                 class="product-image" />
                            @if (image.IsMain)
                            {
                                <div class="main-badge">ãƒ¡ã‚¤ãƒ³</div>
                            }
                            <div class="image-zoom-overlay" 
                                 data-action="open-image-viewer"
                                 data-image-path="@image.ImagePath" 
                                 data-image-alt="@image.AltText">
                                <span class="zoom-icon">ğŸ”</span>
                            </div>
                        </div>
                    }
                </div>
            }
            else
            {
                <div class="image-gallery-flex">
                    <div class="image-item">
                        <img src="/images/no-image.png" 
                             alt="ç”»åƒãªã—" 
                             class="product-image" />
                    </div>
                </div>
            }
        </div>
        
        <!-- å•†å“åŸºæœ¬æƒ…å ± -->
        <div class="product-basic-info">
            <div class="product-header">
                <h2 class="product-name">@Model.Name</h2>
                <div class="product-status">
                    @switch (Model.Status)
                    {
                        case Web.Essentials.Domain.Entities.ProductStatus.PreSale:
                            <span class="status-badge status-pending">è²©å£²é–‹å§‹å‰</span>
                            break;
                        case Web.Essentials.Domain.Entities.ProductStatus.OnSale:
                            <span class="status-badge status-active">è²©å£²ä¸­</span>
                            break;
                        case Web.Essentials.Domain.Entities.ProductStatus.Discontinued:
                            <span class="status-badge status-discontinued">å–æ‰±çµ‚äº†</span>
                            break;
                    }
                </div>
            </div>
            
            <div class="product-price">
                <span class="price-label">ä¾¡æ ¼</span>
                <span class="price-value">Â¥@Model.Price.ToString("N0")</span>
                <span class="price-tax">(ç¨è¾¼)</span>
            </div>
            
            @if (!string.IsNullOrEmpty(Model.Description))
            {
                <div class="product-description">
                    <h3 class="description-title">å•†å“èª¬æ˜</h3>
                    <div class="description-content">
                        @Html.Raw(Model.Description.Replace("\n", "<br />"))
                    </div>
                </div>
            }
            
            <!-- ã‚«ãƒ†ã‚´ãƒªæƒ…å ± -->
            @if (Model.Categories?.Any() == true)
            {
                <div class="product-categories">
                    <h3 class="categories-title">ã‚«ãƒ†ã‚´ãƒª</h3>
                    <div class="categories-list">
                        @foreach (var category in Model.Categories)
                        {
                            <div class="category-item">
                                <a asp-action="Details" asp-controller="Categories" asp-route-id="@category.Id" 
                                   class="category-link">
                                    @category.FullPath
                                </a>
                            </div>
                        }
                    </div>
                </div>
            }
            
            <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ -->
            <div class="product-actions">
                <div class="action-buttons">
                    <a asp-action="Edit" asp-controller="Products" asp-route-id="@Model.Id" 
                       class="btn btn-primary btn-large">
                        <span class="btn-icon">âœ</span>
                        ã“ã®å•†å“ã‚’ç·¨é›†
                    </a>
                    <button type="button" 
                            class="btn btn-outline btn-large" 
                            id="duplicateButton"
                            data-product-id="@Model.Id">
                        <span class="btn-icon">ğŸ“‹</span>
                        è¤‡è£½ã—ã¦æ–°è¦ä½œæˆ
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- å•†å“è©³ç´°æƒ…å ± -->
    <div class="product-details-info">
        <div class="details-tabs">
            <div class="tab-navigation">
                <button class="tab-button active" data-tab="specifications">
                    å•†å“ä»•æ§˜
                </button>
                <button class="tab-button" data-tab="metadata">
                    ç®¡ç†æƒ…å ±
                </button>
            </div>
            
            <!-- å•†å“ä»•æ§˜ã‚¿ãƒ– -->
            <div id="specificationsTab" class="tab-content active">
                <div class="specifications-grid">
                    <div class="spec-item">
                        <label class="spec-label">å•†å“ID</label>
                        <span class="spec-value">@Model.Id</span>
                    </div>
                    
                    @if (!string.IsNullOrEmpty(Model.JanCode))
                    {
                        <div class="spec-item">
                            <label class="spec-label">JANã‚³ãƒ¼ãƒ‰</label>
                            <span class="spec-value">
                                <code class="jan-code">@Model.JanCode</code>
                                <button type="button" 
                                        class="copy-button" 
                                        data-copy-text="@Model.JanCode"
                                        title="ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼">
                                    ğŸ“‹
                                </button>
                            </span>
                        </div>
                    }
                    
                    <div class="spec-item">
                        <label class="spec-label">å•†å“ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</label>
                        <span class="spec-value">
                            @switch (Model.Status)
                            {
                                case Web.Essentials.Domain.Entities.ProductStatus.PreSale:
                                    <span class="status-text">è²©å£²é–‹å§‹å‰</span>
                                    break;
                                case Web.Essentials.Domain.Entities.ProductStatus.OnSale:
                                    <span class="status-text">è²©å£²ä¸­</span>
                                    break;
                                case Web.Essentials.Domain.Entities.ProductStatus.Discontinued:
                                    <span class="status-text">å–æ‰±çµ‚äº†</span>
                                    break;
                            }
                        </span>
                    </div>
                    
                    @if (Model.Images?.Any() == true)
                    {
                        <div class="spec-item">
                            <label class="spec-label">ç”»åƒæ•°</label>
                            <span class="spec-value">@Model.Images.Count() æš</span>
                        </div>
                    }
                </div>
            </div>
            
            <!-- ç®¡ç†æƒ…å ±ã‚¿ãƒ– -->
            <div id="metadataTab" class="tab-content">
                <div class="metadata-grid">
                    <div class="metadata-item">
                        <label class="metadata-label">ä½œæˆæ—¥æ™‚</label>
                        <span class="metadata-value">
                            <time datetime="@Model.CreatedAt.ToString("yyyy-MM-ddTHH:mm:ss")">
                                @Model.CreatedAt.ToString("yyyyå¹´MMæœˆddæ—¥ HH:mm:ss")
                            </time>
                        </span>
                    </div>
                    
                    <div class="metadata-item">
                        <label class="metadata-label">æœ€çµ‚æ›´æ–°æ—¥æ™‚</label>
                        <span class="metadata-value">
                            <time datetime="@Model.UpdatedAt.ToString("yyyy-MM-ddTHH:mm:ss")">
                                @Model.UpdatedAt.ToString("yyyyå¹´MMæœˆddæ—¥ HH:mm:ss")
                            </time>
                        </span>
                    </div>
                    
                    @if (Model.CreatedAt != Model.UpdatedAt)
                    {
                        <div class="metadata-item">
                            <label class="metadata-label">æœ€çµ‚æ›´æ–°ã‹ã‚‰ã®çµŒéæ™‚é–“</label>
                            <span class="metadata-value">
                                @{
                                    var timeDiff = DateTime.Now - Model.UpdatedAt;
                                    var timeDiffText = timeDiff.Days > 0 ? $"{timeDiff.Days}æ—¥å‰" :
                                                      timeDiff.Hours > 0 ? $"{timeDiff.Hours}æ™‚é–“å‰" :
                                                      timeDiff.Minutes > 0 ? $"{timeDiff.Minutes}åˆ†å‰" : "1åˆ†ä»¥å†…";
                                }
                                @timeDiffText
                            </span>
                        </div>
                    }
                </div>
            </div>
            
        </div>
    </div>
</div>


@section Styles {
    <link rel="stylesheet" href="~/css/product-details.css" asp-append-version="true" />
}

@section Scripts {
    <script src="~/js/product-details.js" asp-append-version="true" defer></script>
    <script>
        // å•†å“æƒ…å ±ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã«è¨­å®š
        window.productId = @Model.Id;
        window.productName = '@Model.Name';
    </script>
}