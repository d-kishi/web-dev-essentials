@model Web.Essentials.App.ViewModels.CategoryDetailsViewModel
@{
    ViewData["Title"] = $"„Ç´„ÉÜ„Ç¥„É™Ë©≥Á¥∞ - {Model.Name}";
}

<!-- „Ç´„ÉÜ„Ç¥„É™Ë©≥Á¥∞ÁîªÈù¢ -->
<div class="page-header">
    <div class="page-title-section">
        <h1 class="page-title">„Ç´„ÉÜ„Ç¥„É™Ë©≥Á¥∞</h1>
        <p class="page-description">„Ç´„ÉÜ„Ç¥„É™„Äå@Model.Name„Äç„ÅÆË©≥Á¥∞ÊÉÖÂ†±„ÇíË°®Á§∫„Åó„Åæ„Åô„ÄÇ</p>
    </div>
    <div class="page-actions">
        <a asp-action="Edit" asp-controller="Categories" asp-route-id="@Model.Id" class="btn btn-warning">
            <span class="btn-icon">‚úè</span>
            Á∑®ÈõÜ
        </a>
        <button type="button" 
                class="btn btn-danger" 
                id="deleteButton"
                data-category-id="@Model.Id"
                data-category-name="@Model.Name"
                data-product-count="@Model.ProductCount"
                data-has-children="@(Model.ChildCategories?.Any() == true ? "true" : "false")"
                @(Model.ProductCount > 0 || Model.ChildCategories?.Any() == true ? "disabled title='Èñ¢ÈÄ£ÂïÜÂìÅ„Åæ„Åü„ÅØÂ≠ê„Ç´„ÉÜ„Ç¥„É™„ÅåÂ≠òÂú®„Åô„Çã„Åü„ÇÅÂâäÈô§„Åß„Åç„Åæ„Åõ„Çì'" : "")>
            <span class="btn-icon">üóë</span>
            ÂâäÈô§
        </button>
        <a asp-action="Index" asp-controller="Categories" class="btn btn-secondary">
            <span class="btn-icon">‚Üê</span>
            „Ç´„ÉÜ„Ç¥„É™‰∏ÄË¶ß„Å´Êàª„Çã
        </a>
    </div>
</div>

<!-- „Éë„É≥„Åè„Åö„Éä„Éì -->
<nav class="breadcrumb-nav" aria-label="„Éë„É≥„Åè„Åö„Éä„Éì">
    <ol class="breadcrumb">
        <li class="breadcrumb-item">
            <a asp-action="Index" asp-controller="Home">„Éõ„Éº„É†</a>
        </li>
        <li class="breadcrumb-item">
            <a asp-action="Index" asp-controller="Categories">„Ç´„ÉÜ„Ç¥„É™‰∏ÄË¶ß</a>
        </li>
        @if (!string.IsNullOrEmpty(Model.FullPath))
        {
            var pathParts = Model.FullPath.Split(" > ");
            for (int i = 0; i < pathParts.Length - 1; i++)
            {
                <li class="breadcrumb-item">
                    <span>@pathParts[i]</span>
                </li>
            }
        }
        <li class="breadcrumb-item active" aria-current="page">
            @Model.Name
        </li>
    </ol>
</nav>

<!-- „Ç´„ÉÜ„Ç¥„É™Ë©≥Á¥∞„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
<div class="category-details-container">
    <div class="category-overview">
        <!-- „Ç´„ÉÜ„Ç¥„É™Âü∫Êú¨ÊÉÖÂ†± -->
        <div class="category-basic-info">
            <div class="category-header">
                <h2 class="category-name">@Model.Name</h2>
                <div class="category-level">
                    <span class="level-badge level-@Model.Level">„É¨„Éô„É´ @Model.Level</span>
                    @if (Model.Level == 0)
                    {
                        <span class="level-description">Ôºà„É´„Éº„Éà„Ç´„ÉÜ„Ç¥„É™Ôºâ</span>
                    }
                    else
                    {
                        <span class="level-description">Ôºà@Model.Level ÈöéÂ±§ÁõÆÔºâ</span>
                    }
                </div>
            </div>
            
            @if (!string.IsNullOrEmpty(Model.Description))
            {
                <div class="category-description">
                    <h3 class="description-title">„Ç´„ÉÜ„Ç¥„É™Ë™¨Êòé</h3>
                    <div class="description-content">
                        @Html.Raw(Model.Description.Replace("\n", "<br />"))
                    </div>
                </div>
            }
            
            <!-- ÈöéÂ±§„Éë„Çπ -->
            @if (!string.IsNullOrEmpty(Model.FullPath))
            {
                <div class="category-path">
                    <h3 class="path-title">ÈöéÂ±§„Éë„Çπ</h3>
                    <div class="path-content">
                        <nav class="category-path-nav">
                            @{
                                var pathParts = Model.FullPath.Split(" > ");
                                for (int i = 0; i < pathParts.Length; i++)
                                {
                                    if (i > 0)
                                    {
                                        <span class="path-separator">‚ñ∂</span>
                                    }
                                    if (i == pathParts.Length - 1)
                                    {
                                        <span class="path-current">@pathParts[i]</span>
                                    }
                                    else
                                    {
                                        <span class="path-ancestor">@pathParts[i]</span>
                                    }
                                }
                            }
                        </nav>
                    </div>
                </div>
            }
            
            <!-- Áµ±Ë®àÊÉÖÂ†± -->
            <div class="category-statistics">
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-icon">üì¶</span>
                        <div class="stat-content">
                            <div class="stat-value">@Model.ProductCount</div>
                            <div class="stat-label">ÁôªÈå≤ÂïÜÂìÅÊï∞</div>
                        </div>
                    </div>
                    
                    @if (Model.ChildCategories?.Any() == true)
                    {
                        <div class="stat-item">
                            <span class="stat-icon">üè∑Ô∏è</span>
                            <div class="stat-content">
                                <div class="stat-value">@Model.ChildCategories.Count()</div>
                                <div class="stat-label">Â≠ê„Ç´„ÉÜ„Ç¥„É™Êï∞</div>
                            </div>
                        </div>
                    }
                    
                    <div class="stat-item">
                        <span class="stat-icon">üìÖ</span>
                        <div class="stat-content">
                            <div class="stat-value">
                                @{
                                    var daysSinceCreated = (DateTime.Now - Model.CreatedAt).Days;
                                }
                                @daysSinceCreated Êó•
                            </div>
                            <div class="stat-label">‰ΩúÊàê„Åã„Çâ„ÅÆÊó•Êï∞</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- „Ç¢„ÇØ„Ç∑„Éß„É≥„Éú„Çø„É≥ -->
            <div class="category-actions">
                <div class="action-buttons">
                    <a asp-action="Edit" asp-controller="Categories" asp-route-id="@Model.Id" 
                       class="btn btn-primary btn-large">
                        <span class="btn-icon">‚úè</span>
                        „Åì„ÅÆ„Ç´„ÉÜ„Ç¥„É™„ÇíÁ∑®ÈõÜ
                    </a>
                    <a asp-action="Create" asp-controller="Categories" asp-route-parentId="@Model.Id" 
                       class="btn btn-outline btn-large">
                        <span class="btn-icon">‚ûï</span>
                        Â≠ê„Ç´„ÉÜ„Ç¥„É™„Çí‰ΩúÊàê
                    </a>
                    <button type="button" 
                            class="btn btn-light btn-large" 
                            id="duplicateButton"
                            data-category-id="@Model.Id">
                        <span class="btn-icon">üìã</span>
                        Ë§áË£Ω
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Ë©≥Á¥∞ÊÉÖÂ†±„Çø„Éñ -->
    <div class="category-details-info">
        <div class="details-tabs">
            <div class="tab-navigation">
                <button class="tab-button active" data-tab="products">
                    Èñ¢ÈÄ£ÂïÜÂìÅ (@Model.ProductCount)
                </button>
                @if (Model.ChildCategories?.Any() == true)
                {
                    <button class="tab-button" data-tab="children">
                        Â≠ê„Ç´„ÉÜ„Ç¥„É™ (@Model.ChildCategories.Count())
                    </button>
                }
                <button class="tab-button" data-tab="hierarchy">
                    ÈöéÂ±§ÊÉÖÂ†±
                </button>
                <button class="tab-button" data-tab="metadata">
                    ÁÆ°ÁêÜÊÉÖÂ†±
                </button>
            </div>
            
            <!-- Èñ¢ÈÄ£ÂïÜÂìÅ„Çø„Éñ -->
            <div id="productsTab" class="tab-content active">
                <div class="products-container">
                    @if (Model.Products?.Any() == true)
                    {
                        <div class="products-grid">
                            @foreach (var product in Model.Products)
                            {
                                <div class="product-card">
                                    <div class="product-image">
                                        @if (product.MainImagePath != null)
                                        {
                                            <img src="@product.MainImagePath" alt="@product.Name" class="product-thumbnail" />
                                        }
                                        else
                                        {
                                            <img src="/images/no-image.png" alt="ÁîªÂÉè„Å™„Åó" class="product-thumbnail no-image" />
                                        }
                                    </div>
                                    <div class="product-info">
                                        <h4 class="product-name">
                                            <a asp-action="Details" asp-controller="Products" asp-route-id="@product.Id">
                                                @product.Name
                                            </a>
                                        </h4>
                                        <div class="product-price">¬•@product.Price.ToString("N0")</div>
                                        @if (!string.IsNullOrEmpty(product.Description))
                                        {
                                            <div class="product-description">
                                                @(product.Description.Length > 60 ? product.Description.Substring(0, 60) + "..." : product.Description)
                                            </div>
                                        }
                                        <div class="product-status">
                                            @switch (product.Status)
                                            {
                                                case Web.Essentials.Domain.Entities.ProductStatus.PreSale:
                                                    <span class="status-badge status-pending">Ë≤©Â£≤ÈñãÂßãÂâç</span>
                                                    break;
                                                case Web.Essentials.Domain.Entities.ProductStatus.OnSale:
                                                    <span class="status-badge status-active">Ë≤©Â£≤‰∏≠</span>
                                                    break;
                                                case Web.Essentials.Domain.Entities.ProductStatus.Discontinued:
                                                    <span class="status-badge status-discontinued">ÂèñÊâ±ÁµÇ‰∫Ü</span>
                                                    break;
                                            }
                                        </div>
                                    </div>
                                    <div class="product-actions">
                                        <a asp-action="Details" asp-controller="Products" asp-route-id="@product.Id" 
                                           class="btn btn-info btn-sm">Ë©≥Á¥∞</a>
                                        <a asp-action="Edit" asp-controller="Products" asp-route-id="@product.Id" 
                                           class="btn btn-warning btn-sm">Á∑®ÈõÜ</a>
                                    </div>
                                </div>
                            }
                        </div>
                        
                        <!-- ÂïÜÂìÅ‰∏ÄË¶ß„Å∏„ÅÆ„É™„É≥„ÇØ -->
                        <div class="view-all-products">
                            <a asp-action="Index" asp-controller="Products" asp-route-categoryId="@Model.Id" 
                               class="btn btn-outline">
                                „Åì„ÅÆ„Ç´„ÉÜ„Ç¥„É™„ÅÆÂïÜÂìÅ„Çí„Åô„Åπ„Å¶Ë°®Á§∫
                            </a>
                        </div>
                    }
                    else
                    {
                        <div class="no-products-message">
                            <div class="no-data-icon">üì¶</div>
                            <h3>„Åì„ÅÆ„Ç´„ÉÜ„Ç¥„É™„Å´„ÅØÂïÜÂìÅ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</h3>
                            <p>Êñ∞„Åó„ÅÑÂïÜÂìÅ„ÇíÁôªÈå≤„Åô„Çã„Åã„ÄÅÊó¢Â≠ò„ÅÆÂïÜÂìÅ„Çí„Åì„ÅÆ„Ç´„ÉÜ„Ç¥„É™„Å´Èñ¢ÈÄ£‰ªò„Åë„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ</p>
                            <div class="action-buttons">
                                <a asp-action="Create" asp-controller="Products" asp-route-categoryId="@Model.Id" 
                                   class="btn btn-primary">
                                    Êñ∞„Åó„ÅÑÂïÜÂìÅ„ÇíÁôªÈå≤
                                </a>
                                <a asp-action="Index" asp-controller="Products" 
                                   class="btn btn-outline">
                                    Êó¢Â≠òÂïÜÂìÅ„ÇíÈñ¢ÈÄ£‰ªò„Åë
                                </a>
                            </div>
                        </div>
                    }
                </div>
            </div>
            
            <!-- Â≠ê„Ç´„ÉÜ„Ç¥„É™„Çø„Éñ -->
            @if (Model.ChildCategories?.Any() == true)
            {
                <div id="childrenTab" class="tab-content">
                    <div class="children-container">
                        <div class="children-grid">
                            @foreach (var childCategory in Model.ChildCategories.OrderBy(c => c.SortOrder))
                            {
                                <div class="child-category-card">
                                    <div class="child-category-header">
                                        <h4 class="child-category-name">
                                            <a asp-action="Details" asp-controller="Categories" asp-route-id="@childCategory.Id">
                                                @childCategory.Name
                                            </a>
                                        </h4>
                                        <span class="level-badge level-@childCategory.Level">L@childCategory.Level</span>
                                    </div>
                                    @if (!string.IsNullOrEmpty(childCategory.Description))
                                    {
                                        <div class="child-category-description">
                                            @(childCategory.Description.Length > 80 ? childCategory.Description.Substring(0, 80) + "..." : childCategory.Description)
                                        </div>
                                    }
                                    <div class="child-category-stats">
                                        <span class="stat-item">
                                            <span class="stat-icon">üì¶</span>
                                            @childCategory.ProductCount ÂïÜÂìÅ
                                        </span>
                                        @if (childCategory.HasChildren)
                                        {
                                            <span class="stat-item">
                                                <span class="stat-icon">üè∑Ô∏è</span>
                                                Â≠ê„Ç´„ÉÜ„Ç¥„É™„ÅÇ„Çä
                                            </span>
                                        }
                                    </div>
                                    <div class="child-category-actions">
                                        <a asp-action="Details" asp-controller="Categories" asp-route-id="@childCategory.Id" 
                                           class="btn btn-info btn-sm">Ë©≥Á¥∞</a>
                                        <a asp-action="Edit" asp-controller="Categories" asp-route-id="@childCategory.Id" 
                                           class="btn btn-warning btn-sm">Á∑®ÈõÜ</a>
                                    </div>
                                </div>
                            }
                        </div>
                        
                        <!-- Â≠ê„Ç´„ÉÜ„Ç¥„É™ËøΩÂä† -->
                        <div class="add-child-category">
                            <a asp-action="Create" asp-controller="Categories" asp-route-parentId="@Model.Id" 
                               class="btn btn-primary">
                                <span class="btn-icon">‚ûï</span>
                                Êñ∞„Åó„ÅÑÂ≠ê„Ç´„ÉÜ„Ç¥„É™„Çí‰ΩúÊàê
                            </a>
                        </div>
                    </div>
                </div>
            }
            
            <!-- ÈöéÂ±§ÊÉÖÂ†±„Çø„Éñ -->
            <div id="hierarchyTab" class="tab-content">
                <div class="hierarchy-container">
                    <!-- Ë¶™„Ç´„ÉÜ„Ç¥„É™ÊÉÖÂ†± -->
                    @if (Model.ParentCategory != null)
                    {
                        <div class="hierarchy-section">
                            <h3 class="hierarchy-title">Ë¶™„Ç´„ÉÜ„Ç¥„É™</h3>
                            <div class="parent-category-card">
                                <div class="parent-category-info">
                                    <h4 class="parent-category-name">
                                        <a asp-action="Details" asp-controller="Categories" asp-route-id="@Model.ParentCategory.Id">
                                            @Model.ParentCategory.Name
                                        </a>
                                    </h4>
                                    <span class="level-badge level-@Model.ParentCategory.Level">L@Model.ParentCategory.Level</span>
                                </div>
                                @if (!string.IsNullOrEmpty(Model.ParentCategory.Description))
                                {
                                    <div class="parent-category-description">
                                        @Model.ParentCategory.Description
                                    </div>
                                }
                            </div>
                        </div>
                    }
                    
                    <!-- ÈöéÂ±§ÊßãÈÄ†Ë°®Á§∫ -->
                    <div class="hierarchy-section">
                        <h3 class="hierarchy-title">ÈöéÂ±§ÊßãÈÄ†</h3>
                        <div class="hierarchy-tree">
                            <partial name="_CategoryHierarchy" model="new List<Web.Essentials.App.ViewModels.CategoryTreeNodeViewModel> 
                            { 
                                new Web.Essentials.App.ViewModels.CategoryTreeNodeViewModel 
                                { 
                                    Id = Model.Id, 
                                    Name = Model.Name, 
                                    Description = Model.Description, 
                                    Level = Model.Level, 
                                    FullPath = Model.FullPath, 
                                    ProductCount = Model.ProductCount,
                                    ChildCategories = Model.ChildCategories?.Select(c => new Web.Essentials.App.ViewModels.CategoryTreeNodeViewModel
                                    {
                                        Id = c.Id,
                                        Name = c.Name,
                                        Description = c.Description,
                                        Level = c.Level,
                                        FullPath = c.FullPath,
                                        ProductCount = c.ProductCount,
                                        ChildCategories = c.ChildCategories?.Select(child => new Web.Essentials.App.ViewModels.CategoryTreeNodeViewModel
                                        {
                                            Id = child.Id,
                                            Name = child.Name,
                                            Description = child.Description,
                                            Level = child.Level,
                                            FullPath = child.FullPath,
                                            ProductCount = child.ProductCount
                                        }) ?? Enumerable.Empty<Web.Essentials.App.ViewModels.CategoryTreeNodeViewModel>()
                                    }) ?? Enumerable.Empty<Web.Essentials.App.ViewModels.CategoryTreeNodeViewModel>()
                                } 
                            }" />
                        </div>
                    </div>
                    
                    <!-- ÂêåÈöéÂ±§„Ç´„ÉÜ„Ç¥„É™ -->
                    @if (Model.SiblingCategories?.Any() == true)
                    {
                        <div class="hierarchy-section">
                            <h3 class="hierarchy-title">ÂêåÈöéÂ±§„ÅÆ„Ç´„ÉÜ„Ç¥„É™</h3>
                            <div class="siblings-list">
                                @foreach (var sibling in Model.SiblingCategories)
                                {
                                    <div class="sibling-item @(sibling.Id == Model.Id ? "current" : "")">
                                        @if (sibling.Id == Model.Id)
                                        {
                                            <span class="sibling-name current">@sibling.NameÔºàÁèæÂú®„ÅÆ„Ç´„ÉÜ„Ç¥„É™Ôºâ</span>
                                        }
                                        else
                                        {
                                            <a asp-action="Details" asp-controller="Categories" asp-route-id="@sibling.Id" 
                                               class="sibling-link">
                                                @sibling.Name
                                            </a>
                                        }
                                        <span class="sibling-stats">(@sibling.ProductCount ÂïÜÂìÅ)</span>
                                    </div>
                                }
                            </div>
                        </div>
                    }
                </div>
            </div>
            
            <!-- ÁÆ°ÁêÜÊÉÖÂ†±„Çø„Éñ -->
            <div id="metadataTab" class="tab-content">
                <div class="metadata-grid">
                    <div class="metadata-item">
                        <label class="metadata-label">„Ç´„ÉÜ„Ç¥„É™ID</label>
                        <span class="metadata-value">@Model.Id</span>
                    </div>
                    
                    <div class="metadata-item">
                        <label class="metadata-label">ÈöéÂ±§„É¨„Éô„É´</label>
                        <span class="metadata-value">@Model.Level</span>
                    </div>
                    
                    <div class="metadata-item">
                        <label class="metadata-label">Ë°®Á§∫È†ÜÂ∫è</label>
                        <span class="metadata-value">@Model.SortOrder</span>
                    </div>
                    
                    <div class="metadata-item">
                        <label class="metadata-label">‰ΩúÊàêÊó•ÊôÇ</label>
                        <span class="metadata-value">
                            <time datetime="@Model.CreatedAt.ToString("yyyy-MM-ddTHH:mm:ss")">
                                @Model.CreatedAt.ToString("yyyyÂπ¥MMÊúàddÊó• HH:mm:ss")
                            </time>
                        </span>
                    </div>
                    
                    <div class="metadata-item">
                        <label class="metadata-label">ÊúÄÁµÇÊõ¥Êñ∞Êó•ÊôÇ</label>
                        <span class="metadata-value">
                            <time datetime="@Model.UpdatedAt.ToString("yyyy-MM-ddTHH:mm:ss")">
                                @Model.UpdatedAt.ToString("yyyyÂπ¥MMÊúàddÊó• HH:mm:ss")
                            </time>
                        </span>
                    </div>
                    
                    @if (Model.CreatedAt != Model.UpdatedAt)
                    {
                        <div class="metadata-item">
                            <label class="metadata-label">ÊúÄÁµÇÊõ¥Êñ∞„Åã„Çâ„ÅÆÁµåÈÅéÊôÇÈñì</label>
                            <span class="metadata-value">
                                @{
                                    var timeDiff = DateTime.Now - Model.UpdatedAt;
                                    var timeDiffText = timeDiff.Days > 0 ? $"{timeDiff.Days}Êó•Ââç" :
                                                      timeDiff.Hours > 0 ? $"{timeDiff.Hours}ÊôÇÈñìÂâç" :
                                                      timeDiff.Minutes > 0 ? $"{timeDiff.Minutes}ÂàÜÂâç" : "1ÂàÜ‰ª•ÂÜÖ";
                                }
                                @timeDiffText
                            </span>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/category-details.js" asp-append-version="true" defer></script>
}